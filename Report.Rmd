---
title: "DDS Algorithm"
author: "Dominic Scruton & Philip Hindle"
date: "22 May 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Portfolio Theory

### Introduction

### Capital Asset Pricing Model (CAPM)

### Sharpe Ratio as a Measure of Performance

The Expected return of a portfolio with k assets is simply the weighted sum of expected returns for each asset and is given by:

$$E[R_p] = \sum_{i = 1}^k{w_ir_i} = \mathbf{w}^T\mathbf{r}$$

where $\mathbf{w}$ is a vector of stock weights and $\mathbf{r}$ is a vector of the expected returns for each stock. Defining these functions in matrix algebra notation emphasizes the use of vectorization within the DDS Algorithm. The variance of the expected return is then:

\begin{align*} 
Var[E[R_p]] &= Var[\mathbf{w}^T\mathbf{r}]\\
&= \mathbf{w}^T Var[\mathbf{r}] \mathbf{w}\\
&= \mathbf{w}^T \Sigma \mathbf{w}
\end{align*}

Generally use simple returns when we have many assets. The portfolios Sharpe Ratio is then given as:

$$Sharpe = \frac{E[R_p] - r_f}{SD[R_p]}$$

The Sharpe ratio specifies the Additional expected return for a given level of risk. A higher Sharpe Ratio suggest a more optimal portfolio. 

## Methodology

### Optimization Problem

Optimization is a common theme that underpins the fitting of Statistical models. From the maximization of the log-likelihood function under Linear Models, to the minimization of errors under Neural Network classifiers, optimization is fundamentally important to obtaining objective solutions to many problems in the world of Data Science and Statistical research.

The general Optimization problem can be defined as follows:

\begin{align*} 
x^* = a&rgmin f(x; y)\\
& x \in \Omega
\end{align*}

- discuss the problems- sometimes can't differentiate, other times it is not computationally feasible to find exact answers, when we have large amounts of data and lots of stocks.

In this case, one would like to maximize the Sharpe ratio such that the sum of weights in the portfolio equals one. This optimization problem can be expressed as follows:

$$Max \left( \frac{E[r_p] - r_f}{Std[E[r_p]]} \right) s.t. \sum_{i = 1}^{K} w_i = 1$$

Or in vector notation:

$$Max \left( \frac{\mathbf{w^Tr}}{\sqrt{\mathbf{w}^T \mathbf{\Sigma} \mathbf{w}}} \right) s.t. \|\mathbf{w}\| = 1$$

### Theoretical Solution (i.e. consider the actual mathematical result)

### Discretized Dynamical System (Deterministic Grid Search)

- One of the advantages is that we can set the level of granularity here. i.e. a weight of 12.4 is effectively the same as 12.37838383838, as the qualitative results are effectively the same and in reality, one tends to . Really inefficient- needlessly searches the entire area and not at all granular- becomes extremely computationally inefficient for large numbers of stocks.

### Bisection Method

- Identify an interval (a, b), where the gradient switches sign. Bisection is an example of a more general deterministic method

### Gauss-Newton Method

### Stochastic Grid Search

### Simulated Aneeling

The problem we face with simulated aneeling, in comparison to its standard applications, is that the weights are bounded to lie in the interval [0, 1] and must sum to one. Therefore, we need to decide whether to use normal distributions and truncate any weights to lie in [0, 1] or use a distribution with support [0, 1] (e.g. Beta distribution).

### Other Optimization Methods

There exist a plethora of possible methods to solve the optimization problem identified in this report. The two general contrasting methods discussed are Stochastic and Deterministic forms of optimization.

Discuss the Advantages and disadvantages of the two methods- Deterministic and stochastic optimization methodology and also of the methods in general.

## The DDS Algorithm (R Package)

### Pre-Processing Function

### DDS Algorithm

- Discuss how the expected returns and then the portfolio standard deviation are ANNUALIZED- see Python for Finance course

### Heat Maps and Plots

## Testing

### Unit Testing

Unit testing helps to create robust code. This ensures the code is robust to new versions of R, as well as enabling users to utilize the function correctly. This ensures the function generates the expected output and can deal with arguments of different structure, flagging problems if the structure of input arguments is not appropriate (boundary testing). This ensure code is robust and results are reproducible.

### Boundary Testing

### Simulation

- So far we have tested the function on 3 stocks, so we can conclude that syntactically there are no major issues. However, to assess the performance of the different simulation methods, one really needs to run the functions with a far larger number of stocks. As the number of stocks gets larger, 'edges' of the search space are less likely to be searched for random search. Furthermore, the optimzation function can get stuck in local maxima, which can be problematic.

- Need to be able to simulate data such that we start with the Sharpe ratio and work backwards, to ensure that we know the exact value of the maximum Sharpe ratio and corresponding weights, in order to assess the performance of the different optimization methods.

### Assessing Computational Efficiency

- discuss the computational efficiency of the different optimization methods- measure using the system.time function, for example.
- Also discuss how I improved the computational speed of the function using Parallelization and profiling.


### Example Portfolio

We test and simulate using stock returns from 1 January 2010 to 1 December 2020 inclusive, for Delta Airlines, Walmart and Microsoft stock in a portfolio (could add many more)

## Conclusion

- Discuss the wider applicability of these methods- in Machine Learning, when we have many hyperparameters to tune, rather than using grid search, we can use Gauss- Newton and Simulated Aneeling to massively reduce computationally time and search a far greater space of hyperparameter values- huge applicability in all fields of statistics and machine learning.

## Bibliography

Alison Etheridge. 2002. "A Course in Financial Calculus". Cambridge University Press.

Jonathan Berk, Peter DeMarzo. 2014. "Corporate Finance". Pearson.

Geoffrey Grimmett, David Stirzaker. 2001. "Probability and Random Processes". Oxford University Press.

Thomas Mailund. 2017. "Beginning Data Science in R: Data Analysis, Visualization and Modelling for the Data Scientist". Apress.

Geof Givens, Jennifer Hoeting. 2013. "Computational Statistics". Wiley and Sons.

Paulo Cortez. 2014. "Modern Optimization with R". Springer.

RStudio Team (2016). RStudio: Integrated Development for R. RStudio, Inc., Boston, MA URL http://www.rstudio.com/.

## Appendix

### Python Code

- Attach the equivalent Python code to the above problem, however, no 'package' has been created- BUT could look into this.

### R code

- add any extra pieces of R code here
